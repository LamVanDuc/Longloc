<!DOCTYPE html>
<html lang="en" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/layout.html}">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- The above 4 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <!-- Title  -->
    <title>LongLoc - Shop quần áo thời trang</title>

    <!-- Favicon  -->
    <link rel="icon" href="img/core-img/favicon.png">

    <!-- Core Style CSS -->
    <link rel="stylesheet" href="css/core-style.css">
    <link rel="stylesheet" href="style.css">
    <script src="../static/js/bootstrap.min.js"></script>

</head>

<body layout:fragment="content">
    <!-- ##### Single Product Details Area Start ##### -->
    <section class="single_product_details_area d-flex align-items-center" >

        <div class="single_product_thumb clearfix">
            <div class="product_thumbnail_slides owl-carousel" id="image-detail">
                <img src="img/product-img/product-big-1.jpg" alt="">
                <img src="img/product-img/product-big-2.jpg" alt="">
                <img src="img/product-img/product-big-3.jpg" alt="">
            </div>
        </div>

        <!-- Single Product Description -->
        <div class="single_product_desc clearfix">
            <span name="chatLieu"></span>
            <a>
                <h2 name="tenSanPham"></h2>
            </a>
            <p class="product-price " name="price"><span  class="old-price"></span></p>
            <p class="product-desc" name="desc"></p>

            <!-- Form -->
            <form class="cart-form clearfix" method="post">
                <!-- Select Box -->
                <div class="select-box d-flex mt-50 mb-30">
                    <select name="select" id="productSize" onchange="getSanpham()" class="mr-5">
                        <option> chọn danh mục </option>
                        <option value="5465"> adag </option>
                        <option value="5465"> danh muc </option>
                        <option value="5465"> danh muc </option>
                    </select>
                    <select name="select" id="productColor" onchange="getSanpham()">
                        <option> chọn danh mục </option>
                        <option value="5654"> chọn dấgadg mục </option>
                    </select>
                </div>
                <div class="cart-fav-box d-flex align-items-center">

                    <button type="button" name="addtocart" onclick="themGioHang()"  class="btn essence-btn">Thêm Giỏ Hàng</button>

                </div>
            </form>
        </div>

    </section>

    <!-- ##### Single Product Details Area End ##### -->
<!--    <script src="js/jquery/jquery-2.2.4.min.js"></script>-->
<!--    <script src="js/classy-nav.min.js"></script>-->
<!--    <script src="js/active.js"></script>-->
<!--    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>-->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js" ></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js" ></script>

<script>
    var idSanphamCha ='';

    function getParameter(p) {
        var url = window.location.search.substring(1);
        var varUrl = url.split('&');
        for (var i = 0; i < varUrl.length; i++)
        {
            var parameter = varUrl[i].split('=');
            if (parameter[0] == p)
            {
                return parameter[1];
            }
        }
    }

    $(document).ready(function (){
        idSanphamCha = getParameter('id')

        var htmlContent ='';
        $.ajax({
            url: '/api/v1/sanpham/detail/'+idSanphamCha,
            type: 'GET',
            dataType: "json",
            contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
            success: function (response) {
               var htmlSelect ='<option>Chọn Kích cỡ</option>';
                response.data.size.forEach(function (item){
                    htmlSelect +='<option value="'+item+'">'+item+'</option>'
                });
                $('select[id=productSize]').html(htmlSelect);
                // if (response.data.images.length <=0){
                //        htmlContent = '<img class="w-100 h-100" src="https://cf.shopee.vn/file/aa953c05529166595260cca216f84c24_tn" alt=" slide">\n'
                //
                //     $('#image-detail').html(htmlContent)
                // }else {
                //     response.data.image.forEach(function (item){
                //         htmlContent +=  '<img class="w-100 h-100" src="'+item.tenAnh+'" alt="">\n'
                //         $('#image-detail').html(htmlContent)
                //     })
                // }







                // htmlContent = '<option>Chọn màu</option>'
                // response.data.color.forEach(function (item){
                //     htmlContent +='<option value="'+item+'">'+item+'</option>'
                // })
                // $('#productColor').innerHTML=htmlContent;
                //
                // $('span[name=chatLieu]').text(response.data.sanpham.chatLieu);
                // $('h2[name=tenSanPham]').text(response.data.sanpham.tenSanPham);
                // $('p[name=price]').text(response.data.sanpham.giaBan);
                // $('p[name=desc]').text(response.data.sanpham.moTa);






            },
            error: function (err) {
                alert("error : " + err.message);
            }
        });
    });

    var idSanpham = '';
    function getSanpham(){
      var color = $('#productColor').val();
      var size = $('#productSize').val();

      if (checkvalue(color) && checkvalue(size)){
          alert("ok")
      }else {
          alert("false")
      }
    }

    function checkvalue(value){
        if (color === null || color === undefined || color ===''){
            return false;
        }else {
            return true;
        }
    }

    function themGioHang(){
        if (idSanpham === '' || idSanpham === null || idSanpham === undefined){
            $('#message').html('<div class="alert alert-danger" role="alert" >Vui lòng chọn size và màu sắc yêu thích !</div>')
        }else {
            var dataGiohang ={
                idSanpham : idSanpham,
                soLuong : $('#soluongmua').val()
            }

            $.ajax({
                url: '/api/v1/giohang/add',
                type: 'POST',
                dataType: "json",
                data : JSON.stringify(dataGiohang),
                contentType: 'application/json',
                // headers: {
                //     "Content-Type": "application/json",
                //     "Accept": "application/json",
                //     "Authorization": "Bearer "+jwt
                // },
                success: function (response) {
                    $('#message').html('<div class="alert alert-success" role="alert" >Thêm giỏ hàng thành công .</div>')
                },
                error: function (err) {
                    if (err.status === 500){
                        location.href="/login";
                    }
                    if (err.message === undefined){
                        alert(err.responseJSON.message)
                    }
                    alert("error : " + err.message);
                }
            });
        }

    }

</script>
</body>

</html>